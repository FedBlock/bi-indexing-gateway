<!DOCTYPE html>
<html>
<head>
    <title>Clean SDK Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .result { background: #f5f5f5; padding: 10px; margin: 10px 0; border-radius: 4px; }
        .error { background: #ffebee; border-left: 4px solid #f44336; }
        .success { background: #e8f5e8; border-left: 4px solid #4caf50; }
        button { padding: 10px 20px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0056b3; }
    </style>
</head>
<body>
    <h1>🧪 Clean SDK Test</h1>
    
    <div class="result">
        <h3>1. SDK 로드 테스트</h3>
        <div id="loadResult">테스트 중...</div>
    </div>
    
    <div class="result">
        <h3>2. SDK 초기화 테스트</h3>
        <div id="initResult">대기 중...</div>
    </div>
    
    <div class="result">
        <h3>3. Hardhat 인덱스 생성 테스트</h3>
        <button onclick="testCreateIndex()">Hardhat Purpose 인덱스 생성</button>
        <div id="testResult">대기 중...</div>
    </div>
    
    <script src="./bi-index-sdk/lib/browser.js"></script>
    <script>
        let sdk = null;
        
        // 1. SDK 로드 테스트
        function testSDKLoad() {
            const loadDiv = document.getElementById('loadResult');
            
            try {
                console.log('=== SDK Load Test ===');
                console.log('typeof BiIndexSDK:', typeof BiIndexSDK);
                console.log('BiIndexSDK:', BiIndexSDK);
                
                if (typeof BiIndexSDK === 'function') {
                    loadDiv.innerHTML = '✅ SDK 로드 성공 - BiIndexSDK is a function';
                    loadDiv.className = 'result success';
                    return true;
                } else {
                    loadDiv.innerHTML = '❌ SDK 로드 실패 - BiIndexSDK is not a function';
                    loadDiv.className = 'result error';
                    return false;
                }
            } catch (error) {
                loadDiv.innerHTML = '❌ SDK 로드 에러: ' + error.message;
                loadDiv.className = 'result error';
                return false;
            }
        }
        
        // 2. SDK 초기화 테스트
        function testSDKInit() {
            const initDiv = document.getElementById('initResult');
            
            try {
                console.log('=== SDK Init Test ===');
                
                sdk = new BiIndexSDK({
                    indexServerAddr: 'localhost:50052',
                    pvdServerAddr: 'localhost:19001',
                    accessServerAddr: 'localhost:19002'
                });
                
                console.log('SDK created:', sdk);
                console.log('SDK methods:', Object.getOwnPropertyNames(Object.getPrototypeOf(sdk)));
                
                initDiv.innerHTML = '✅ SDK 초기화 성공';
                initDiv.className = 'result success';
                return true;
                
            } catch (error) {
                console.error('SDK init error:', error);
                initDiv.innerHTML = '❌ SDK 초기화 실패: ' + error.message;
                initDiv.className = 'result error';
                return false;
            }
        }
        
        // 3. Hardhat 인덱스 생성 테스트
        async function testCreateIndex() {
            const testDiv = document.getElementById('testResult');
            
            if (!sdk) {
                testDiv.innerHTML = '❌ SDK가 초기화되지 않았습니다';
                testDiv.className = 'result error';
                return;
            }
            
            try {
                console.log('=== Hardhat Index Creation Test ===');
                testDiv.innerHTML = '🔄 Hardhat Purpose 인덱스 생성 중...';
                testDiv.className = 'result';
                
                const result = await sdk.createIndex('hardhat', 'purpose');
                
                console.log('Index creation result:', result);
                testDiv.innerHTML = '✅ 인덱스 생성 성공:<br><pre>' + JSON.stringify(result, null, 2) + '</pre>';
                testDiv.className = 'result success';
                
            } catch (error) {
                console.error('Index creation error:', error);
                testDiv.innerHTML = '❌ 인덱스 생성 실패: ' + error.message;
                testDiv.className = 'result error';
            }
        }
        
        // 페이지 로드 시 자동 테스트
        window.onload = function() {
            console.log('=== Starting Clean SDK Test ===');
            
            // 1. SDK 로드 테스트
            const loadSuccess = testSDKLoad();
            
            if (loadSuccess) {
                // 2. SDK 초기화 테스트
                setTimeout(() => {
                    testSDKInit();
                }, 100);
            }
        };
    </script>
</body>
</html>
