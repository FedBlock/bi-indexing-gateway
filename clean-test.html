<!DOCTYPE html>
<html>
<head>
    <title>Clean SDK Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .result { background: #f5f5f5; padding: 10px; margin: 10px 0; border-radius: 4px; }
        .error { background: #ffebee; border-left: 4px solid #f44336; }
        .success { background: #e8f5e8; border-left: 4px solid #4caf50; }
        button { padding: 10px 20px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0056b3; }
    </style>
</head>
<body>
    <h1>ğŸ§ª Clean SDK Test</h1>
    
    <div class="result">
        <h3>1. SDK ë¡œë“œ í…ŒìŠ¤íŠ¸</h3>
        <div id="loadResult">í…ŒìŠ¤íŠ¸ ì¤‘...</div>
    </div>
    
    <div class="result">
        <h3>2. SDK ì´ˆê¸°í™” í…ŒìŠ¤íŠ¸</h3>
        <div id="initResult">ëŒ€ê¸° ì¤‘...</div>
    </div>
    
    <div class="result">
        <h3>3. Hardhat ì¸ë±ìŠ¤ ìƒì„± í…ŒìŠ¤íŠ¸</h3>
        <button onclick="testCreateIndex()">Hardhat Purpose ì¸ë±ìŠ¤ ìƒì„±</button>
        <div id="testResult">ëŒ€ê¸° ì¤‘...</div>
    </div>
    
    <script src="./bi-index-sdk/lib/browser.js"></script>
    <script>
        let sdk = null;
        
        // 1. SDK ë¡œë“œ í…ŒìŠ¤íŠ¸
        function testSDKLoad() {
            const loadDiv = document.getElementById('loadResult');
            
            try {
                console.log('=== SDK Load Test ===');
                console.log('typeof BiIndexSDK:', typeof BiIndexSDK);
                console.log('BiIndexSDK:', BiIndexSDK);
                
                if (typeof BiIndexSDK === 'function') {
                    loadDiv.innerHTML = 'âœ… SDK ë¡œë“œ ì„±ê³µ - BiIndexSDK is a function';
                    loadDiv.className = 'result success';
                    return true;
                } else {
                    loadDiv.innerHTML = 'âŒ SDK ë¡œë“œ ì‹¤íŒ¨ - BiIndexSDK is not a function';
                    loadDiv.className = 'result error';
                    return false;
                }
            } catch (error) {
                loadDiv.innerHTML = 'âŒ SDK ë¡œë“œ ì—ëŸ¬: ' + error.message;
                loadDiv.className = 'result error';
                return false;
            }
        }
        
        // 2. SDK ì´ˆê¸°í™” í…ŒìŠ¤íŠ¸
        function testSDKInit() {
            const initDiv = document.getElementById('initResult');
            
            try {
                console.log('=== SDK Init Test ===');
                
                sdk = new BiIndexSDK({
                    indexServerAddr: 'localhost:50052',
                    pvdServerAddr: 'localhost:19001',
                    accessServerAddr: 'localhost:19002'
                });
                
                console.log('SDK created:', sdk);
                console.log('SDK methods:', Object.getOwnPropertyNames(Object.getPrototypeOf(sdk)));
                
                initDiv.innerHTML = 'âœ… SDK ì´ˆê¸°í™” ì„±ê³µ';
                initDiv.className = 'result success';
                return true;
                
            } catch (error) {
                console.error('SDK init error:', error);
                initDiv.innerHTML = 'âŒ SDK ì´ˆê¸°í™” ì‹¤íŒ¨: ' + error.message;
                initDiv.className = 'result error';
                return false;
            }
        }
        
        // 3. Hardhat ì¸ë±ìŠ¤ ìƒì„± í…ŒìŠ¤íŠ¸
        async function testCreateIndex() {
            const testDiv = document.getElementById('testResult');
            
            if (!sdk) {
                testDiv.innerHTML = 'âŒ SDKê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤';
                testDiv.className = 'result error';
                return;
            }
            
            try {
                console.log('=== Hardhat Index Creation Test ===');
                testDiv.innerHTML = 'ğŸ”„ Hardhat Purpose ì¸ë±ìŠ¤ ìƒì„± ì¤‘...';
                testDiv.className = 'result';
                
                const result = await sdk.createIndex('hardhat', 'purpose');
                
                console.log('Index creation result:', result);
                testDiv.innerHTML = 'âœ… ì¸ë±ìŠ¤ ìƒì„± ì„±ê³µ:<br><pre>' + JSON.stringify(result, null, 2) + '</pre>';
                testDiv.className = 'result success';
                
            } catch (error) {
                console.error('Index creation error:', error);
                testDiv.innerHTML = 'âŒ ì¸ë±ìŠ¤ ìƒì„± ì‹¤íŒ¨: ' + error.message;
                testDiv.className = 'result error';
            }
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ í…ŒìŠ¤íŠ¸
        window.onload = function() {
            console.log('=== Starting Clean SDK Test ===');
            
            // 1. SDK ë¡œë“œ í…ŒìŠ¤íŠ¸
            const loadSuccess = testSDKLoad();
            
            if (loadSuccess) {
                // 2. SDK ì´ˆê¸°í™” í…ŒìŠ¤íŠ¸
                setTimeout(() => {
                    testSDKInit();
                }, 100);
            }
        };
    </script>
</body>
</html>
